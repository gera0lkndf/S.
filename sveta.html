<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Старый Рабочий Стол</title>
<style>
  :root{--win-bg:#090089;--work:#ff0000;--title-color:#fff}
  html,body{height:100%;margin:0;font-family: 'MS Sans Serif', Arial, sans-serif;}
  body{
    background: url('wallpaper.jpg') center/cover no-repeat fixed;
    overflow:hidden;
    user-select:none;
  }
  /* desktop icons */
  .icon{position:absolute;width:72px;text-align:center;color:#fff;font-size:12px}
  .icon img{width:48px;height:48px;display:block;margin:0 auto}
  .icon span{display:block;margin-top:4px}

  /* window */
  .window{
    position:absolute;
    width:420px;
    height:300px;
    background:var(--win-bg);
    border:2px solid #000;
    box-shadow:4px 4px 0 rgba(0,0,0,0.4);
    display:flex;flex-direction:column;
    overflow:hidden;
  }
  .title-bar{background:var(--title);color:var(--title-color);padding:4px 6px;display:flex;align-items:center;justify-content:space-between;cursor:move}
  .title-left{display:flex;gap:8px;align-items:center}
  .title-buttons{display:flex;gap:6px}
  .btn{width:16px;height:14px;border:1px solid #000;background:#0b0061;cursor:pointer}
  .content{flex:1;background:#fff;padding:8px;overflow:auto}

  /* file list */
  .file{display:flex;gap:8px;align-items:center;padding:6px;border-radius:4px;cursor:default}
  .file:hover{background:#eef}
  .file img{width:28px;height:28px}
  .file .name{font-size:13px}

  /* resizer */
  .resizer{width:12px;height:12px;position:absolute;right:0;bottom:0;cursor:se-resize;background:linear-gradient(45deg,#888,#ccc);}

  /* image viewer style */
  .viewer-img{max-width:100%;max-height:100%;display:block;margin:0 auto}

  /* small helper */
  .muted{color:#666;font-size:12px}
</style>
</head>
<body>

<!-- desktop icons -->
<div class="icon" style="top:20px;left:20px;" ondblclick="openFolder('Света')">
  <img src="folder.png" alt="folder" onerror="this.style.display='none'" />
  <span>Света</span>
</div>
<div class="icon" style="top:20px;left:110px;" ondblclick="openFolder('Работа')">
  <img src="folder.png" alt="folder" onerror="this.style.display='none'" />
  <span>Работа</span>
</div>
<div class="icon" style="top:20px;left:200px;" ondblclick="openFolder('Рождество')">
  <img src="folder.png" alt="folder" onerror="this.style.display='none'" />
  <span>Рождество</span>
</div>
<div class="icon" style="top:20px;left:290px;" ondblclick="openFolder('Личные')">
  <img src="folder.png" alt="folder" onerror="this.style.display='none'" />
  <span>Личные</span>
</div>

<!-- container where windows will be injected -->
<div id="windows-root"></div>

<script>
// --- File system definition (you asked, я придумал) ---
const filesystem = {
  'Света': [
    'video.mp4',
    'sveta_photo1.jpg',
    'sveta_note.txt'
  ],
  'Работа': [
    'отчёт_квартал.txt',
    'контракт.jpg',
    'presentation.pptx'
  ],
  'Рождество': [
    'семейное_фото.jpg',
    'салюты.jpg',
    'церковь_костер.mp4'
  ],
  'Личные': [
    'покупки.txt',
    'meme.jpg',
    'friend_video.mp4'
  ]
};
const rootAssets = new Set([
  'video.mp4', 'sveta_photo1.jpg', 'sveta_note.txt',
  'meme.jpg', 'море_panorama.jpg', 'церковь_костер.mp4'
]);

const fileIcons = {
  txt: 'txt.png',
  jpg: 'jpg.png',
  jpeg: 'jpeg.png',
  mp4: 'mp4.png'
};

function ext(name){ const m = name.match(/\.([^.]+)$/); return m? m[1].toLowerCase() : ''; }

let zIndexCounter = 10;
function createWindow({id, title, width=420, height=300, left=120, top=120, contentDOM}){
  const win = document.createElement('div');
  win.className = 'window';
  win.id = id;
  win.style.width = width+'px';
  win.style.height = height+'px';
  win.style.left = left+'px';
  win.style.top = top+'px';
  win.style.zIndex = ++zIndexCounter;

  win.innerHTML = `
    <div class="title-bar" onmousedown="dragStart(event, '${id}')">
      <div class="title-left"><strong>${title}</strong></div>
      <div class="title-buttons"><div class="btn" onclick="closeWindow('${id}')">X</div></div>
    </div>
    <div class="content" id="${id}-content"></div>
    <div class="resizer" onmousedown="resizeStart(event, '${id}')"></div>
  `;

  document.getElementById('windows-root').appendChild(win);
  const content = document.getElementById(id+'-content');
  if(contentDOM) content.appendChild(contentDOM);
  attachFocusHandlers(win);
  return win;
}

function closeWindow(id){
  const el = document.getElementById(id);
  if(el) el.remove();
}

function attachFocusHandlers(win){
  win.addEventListener('mousedown', ()=>{ win.style.zIndex = ++zIndexCounter; });
}

let dragState = null;
function dragStart(e, id){
  if(e.button !== 0) return; // left only
  const win = document.getElementById(id);
  dragState = {win, startX:e.clientX, startY:e.clientY, origLeft:win.offsetLeft, origTop:win.offsetTop};
  document.addEventListener('mousemove', dragging);
  document.addEventListener('mouseup', dragEnd);
}
function dragging(e){
  if(!dragState) return;
  dragState.win.style.left = (dragState.origLeft + e.clientX - dragState.startX) + 'px';
  dragState.win.style.top = (dragState.origTop + e.clientY - dragState.startY) + 'px';
}
function dragEnd(){ document.removeEventListener('mousemove', dragging); dragState = null; }

let resizeState = null;
function resizeStart(e, id){
  if(e.button !== 0) return;
  const win = document.getElementById(id);
  resizeState = {win, startX:e.clientX, startY:e.clientY, origW:win.offsetWidth, origH:win.offsetHeight};
  document.addEventListener('mousemove', resizing);
  document.addEventListener('mouseup', resizeEnd);
  e.stopPropagation();
}
function resizing(e){
  if(!resizeState) return;
  const nx = Math.max(200, resizeState.origW + e.clientX - resizeState.startX);
  const ny = Math.max(120, resizeState.origH + e.clientY - resizeState.startY);
  resizeState.win.style.width = nx + 'px';
  resizeState.win.style.height = ny + 'px';
}
function resizeEnd(){ document.removeEventListener('mousemove', resizing); resizeState = null; }

function openFolder(folderId){
  const files = filesystem[folderId] || [];
  // create list
  const list = document.createElement('div');
  list.style.display = 'flex';
  list.style.flexDirection = 'column';
  list.style.gap = '6px';

  files.forEach(name => {
    const row = document.createElement('div');
    row.className = 'file';
    const extension = ext(name);
    const img = document.createElement('img');
    img.alt = extension;
    img.src = fileIcons[extension] || '';
    img.onerror = function(){ this.style.display='none'; };
    const nm = document.createElement('div'); nm.className='name'; nm.textContent = name;
    const small = document.createElement('div'); small.className='muted'; small.textContent = extension.toUpperCase();
    row.appendChild(img);
    row.appendChild(nm);
    row.appendChild(small);
    row.ondblclick = ()=> openFile(name);
    list.appendChild(row);
  });

  createWindow({id:'folder-'+folderId, title: folderId, contentDOM: list, left: 120 + Math.random()*80, top:120 + Math.random()*80});
}

function openFile(filename){
  const existsInRoot = rootAssets.has(filename);
  const extension = ext(filename);

  if(!existsInRoot){
    const err = document.createElement('div'); err.innerHTML = '<p>Файл повреждён</p>';
    createWindow({id:'err-'+Date.now(), title:'Ошибка', contentDOM:err, left:200, top:200});
    return;
  }

  if(extension==='jpg' || extension==='jpeg' || extension==='png'){
    openImageViewer(filename);
  } else if(extension==='mp4' || extension==='webm'){
    openMediaPlayer(filename);
  } else if(extension==='txt'){
    openTextFile(filename);
  } else {
    const u = document.createElement('div'); u.innerHTML = '<p>Неизвестный формат</p>';
    createWindow({id:'unk-'+Date.now(), title:'Ошибка', contentDOM:u});
  }
}

function openImageViewer(src){
  const container = document.createElement('div');
  const img = document.createElement('img'); img.className='viewer-img'; img.src = src + '?v=' + Date.now();
  img.onerror = ()=>{ container.innerHTML = '<p>Файл повреждён</p>'; };
  container.appendChild(img);
  createWindow({id:'img-'+Date.now(), title: src, contentDOM:container, width:480, height:360, left:150 + Math.random()*120, top:150 + Math.random()*80});
}

function openMediaPlayer(src){
  const container = document.createElement('div');
  const video = document.createElement('video'); video.controls=true; video.style.width='100%';
  const source = document.createElement('source'); source.src = src; source.type='video/mp4';
  video.appendChild(source);
  video.onerror = ()=>{ container.innerHTML = '<p>Файл повреждён</p>'; };
  container.appendChild(video);
  createWindow({id:'media-'+Date.now(), title: 'Media - '+src, contentDOM:container, width:520, height:340, left:180, top:160});
}

function openTextFile(src){
  const container = document.createElement('div');
  const pre = document.createElement('pre'); pre.textContent = 'Загрузка...'; container.appendChild(pre);
  createWindow({id:'text-'+Date.now(), title: src, contentDOM:container, width:420, height:300});

  fetch(src).then(r=>{
    if(!r.ok) throw new Error('no');
    return r.text();
  }).then(text=>{
    pre.textContent = text;
  }).catch(()=>{
    pre.textContent = 'Файл повреждён';
  });
}

window.dragStart = dragStart;
window.resizeStart = resizeStart;
window.openFolder = openFolder;
window.closeWindow = closeWindow;
window.openFile = openFile;

const tip = document.createElement('div'); tip.innerHTML = '<p class="muted">Двойной клик по папке, двойной клик по файлу.</p>';
createWindow({id:'tip', title:'Подсказка', contentDOM:tip, left:20, top:360, width:360, height:120});

</script>

</body>
</html>
